<!DOCTYPE html>
<html>
<head>
  <title>Debug Storage</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    pre {
      background: white;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Storage Debug Tool</h1>
  <button id="viewRaw">View Raw Storage</button>
  <button id="viewDecompressed">View Decompressed Storage</button>
  <button id="clearStorage">Clear All Storage</button>

  <h2>Raw Storage Data:</h2>
  <pre id="rawOutput">Click "View Raw Storage" to see data</pre>

  <h2>Decompressed Data:</h2>
  <pre id="decompressedOutput">Click "View Decompressed Storage" to see data</pre>

  <script type="module">
    import { getWatchlist, getNewChapters, getSettings } from './lib/storage-manager.js';

    document.getElementById('viewRaw').addEventListener('click', async () => {
      const raw = await browser.storage.sync.get(null);
      document.getElementById('rawOutput').textContent = JSON.stringify(raw, null, 2);
    });

    document.getElementById('viewDecompressed').addEventListener('click', async () => {
      const watchlist = await getWatchlist();
      const newChapters = await getNewChapters();
      const settings = await getSettings();

      const data = {
        watchlist,
        newChapters,
        settings
      };

      document.getElementById('decompressedOutput').textContent = JSON.stringify(data, null, 2);
    });

    document.getElementById('clearStorage').addEventListener('click', async () => {
      if (confirm('Are you sure you want to clear ALL storage? This cannot be undone!')) {
        await browser.storage.sync.clear();
        alert('Storage cleared!');
        document.getElementById('rawOutput').textContent = 'Storage cleared';
        document.getElementById('decompressedOutput').textContent = 'Storage cleared';
      }
    });
  </script>
</body>
</html>
